<div *ngIf="report" class="report-content">
    <div>
        <md-input-container>
            <input mdInput placeholder="Report name" [(ngModel)]="report.name" />
        </md-input-container>
        <md-input-container>
            <input mdInput placeholder="Branded keywords" [(ngModel)]="report.keywords" />
        </md-input-container>
        <input type="file" accept=".csv" (change)="onFileChange($event)" />
        <button md-raised-button color="primary" (click)="updateData()">Save changes</button>
    </div>
    <div class="scrolling-content">
        <md-tab-group>
            <md-tab label="CSV_import">
                <table>
                    <tr>
                        <th>Queries</th>
                        <th>Clicks</th>
                        <th>Impressions</th>
                        <th>CTR</th>
                        <th>Position</th>
                    </tr>
                    <tr *ngFor="let data of data">
                        <td>{{ data.queries }}</td>
                        <td>{{ data.clicks }}</td>
                        <td>{{ data.impressions }}</td>
                        <td>{{ data.ctr | percent:'1.0-2' }}</td>
                        <td>{{ data.position }}</td>
                    </tr>
                </table>
            </md-tab>
            <md-tab label="CSV 5+">
                <table>
                    <tr>
                        <th>Queries</th>
                        <th>Clicks</th>
                        <th>Impressions</th>
                        <th>CTR</th>
                        <th>Position</th>
                    </tr>
                    <tr *ngFor="let data of filteredData">
                        <td>{{ data.queries }}</td>
                        <td>{{ data.clicks }}</td>
                        <td>{{ data.impressions }}</td>
                        <td>{{ data.ctr | percent:'1.0-2' }}</td>
                        <td>{{ data.position }}</td>
                    </tr>
                </table>
            </md-tab>
            <md-tab label="All Queries">
                <table>
                    <tr>
                        <th>Queries</th>
                        <th>Clicks</th>
                        <th>Impressions</th>
                        <th>Position</th>
                        <th>CTR</th>
                        <th>Instances</th>
                        <th>Expected CTR</th>
                        <th>CTR&#916;</th>
                        <th>Expected Clicks</th>
                        <th>Traffic Loss</th>
                        <th>Traffic Gain</th>
                        <th>#1</th>
                        <th>#2</th>
                        <th>#3</th>
                        <th>#4</th>
                        <th>#5</th>
                        <th>#6</th>
                        <th>#7</th>
                        <th>#8</th>
                        <th>#9</th>
                        <th>#10</th>
                        <th>1+</th>
                    </tr>
                    <tr *ngFor="let data of allQueriesData">
                        <td>{{ data.queries }}</td>
                        <td>{{ data.clicks }}</td>
                        <td>{{ data.impressions }}</td>
                        <td>{{ data.position }}</td>
                        <td>{{ data.calculatedCtr | percent:'1.0-0' }}</td>
                        <td>{{ data.instance }}</td>
                        <td>{{ data.expected_ctr | percent:'1.0-2' }}</td>
                        <td>{{ data.ctr_delta | percent:'1.0-2' }}</td>
                        <td>{{ data.expected_clicks | round}}</td>
                        <td>{{ data.traffic_loss | round }}</td>
                        <td>{{ data.traffic_gain | round }}</td>
                        <td *ngFor="let pos of data.nr">{{ pos | round }}</td>
                    </tr>
                </table>
            </md-tab>
            <md-tab label="Non-Branded">
                <table>
                    <tr>
                        <th>Queries</th>
                        <th>Clicks</th>
                        <th>Impressions</th>
                        <th>Position</th>
                        <th>CTR</th>
                        <th>Instances</th>
                        <th>Expected CTR</th>
                        <th>CTR&#916;</th>
                        <th>Expected Clicks</th>
                        <th>Traffic Loss</th>
                        <th>Traffic Gain</th>
                        <th>#1</th>
                        <th>#2</th>
                        <th>#3</th>
                        <th>#4</th>
                        <th>#5</th>
                        <th>#6</th>
                        <th>#7</th>
                        <th>#8</th>
                        <th>#9</th>
                        <th>#10</th>
                        <th>1+</th>
                    </tr>
                    <tr *ngFor="let data of nonBrandedData">
                        <td>{{ data.queries }}</td>
                        <td>{{ data.clicks }}</td>
                        <td>{{ data.impressions }}</td>
                        <td>{{ data.position }}</td>
                        <td>{{ data.ctr | percent:'1.0-2' }}</td>
                        <td>{{ data.instance }}</td>
                        <td>{{ data.expected_ctr | percent:'1.0-2' }}</td>
                        <td>{{ data.ctr_delta | percent:'1.0-2' }}</td>
                        <td>{{ data.expected_clicks | round }}</td>
                        <td>{{ data.traffic_loss | round}}</td>
                        <td>{{ data.traffic_gain | round }}</td>
                        <td *ngFor="let pos of data.nr">{{ pos | round }}</td>
                    </tr>
                </table>
            </md-tab>
            <md-tab label="Report">
                <table>
                    <tr>
                        <th colspan="2">All Queries</th>
                    </tr>
                    <tr>
                        <th>Traffic Loss</th>
                        <th>Traffic Gain</th>
                    </tr>
                    <tr>
                        <td>{{ (all_queries_traffic_loss * 100 | round ) /100  }}</td>
                        <td>{{ (all_queries_traffic_gain * 100 | round ) /100}}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Non-Branded Queries</th>
                    </tr>
                    <tr>
                        <th>Traffic Loss</th>
                        <th>Traffic Gain</th>
                    </tr>
                    <tr>
                        <td>{{ (non_branded_traffic_loss * 100 | round ) /100 }}</td>
                        <td>{{ (non_branded_traffic_gain * 100 | round ) /100 }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Branded Under-Performance</th>
                    </tr>
                    <tr>
                        <td>Traffic Loss</td>
                        <td>{{ ((all_queries_traffic_loss - non_branded_traffic_loss)  * 100 | round ) /100 }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <td>Potential traffic (non branded)</td>
                        <td>{{ non_branded_traffic_loss >= 0 ? (non_branded_traffic_loss  * 100 | round ) /100 : (non_branded_traffic_loss*(-1) * 100 | round ) /100 }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Top Ten Winners</th>
                        <th>Traffic gain</th>
                    </tr>
                    <tr *ngFor="let item of top_traffic_gain; let i = index">
                        <td>{{ i + 1 }}</td>
                        <td>{{ item.query }}</td>
                        <td>{{ (item.traffic_gain * 100 | round)/100 }}</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>Top 10 gain traffic</td>
                        <td>{{ (sum_top_traffic_gain * 100 | round)/100 }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Top Ten Losers</th>
                        <th>Traffic loss</th>
                    </tr>
                    <tr *ngFor="let item of top_traffic_loss; let i = index">
                        <td>{{ i + 1 }}</td>
                        <td>{{ item.query }}</td>
                        <td>{{ (item.traffic_loss * 100 | round) / 100 }}</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>Top 10 gain traffic</td>
                        <td>{{ (sum_top_traffic_loss * 100 | round) / 100 }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Top 10 CTR Statistics</th>
                    </tr>
                    <tr *ngFor="let pos of top_ctr_statistics">
                        <td>Position {{ pos.position }}</td>
                        <td>{{ pos.ctr_calculated | percent:'1.0-0' }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Current keywords positions</th>
                    </tr>
                    <tr *ngFor="let pos of positions; let i = index">
                        <td>Position {{ i + 1 }}</td>
                        <td>{{ pos }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="3">Non branded keywords (if scenario)</th>
                    </tr>
                    <tr>
                        <th>Position</th>
                        <th>Clicks</th>
                        <th>Difference</th>
                    </tr>
                    <tr *ngFor="let pos of non_branded_keywords">
                        <td>{{ pos.position }}</td>
                        <td>{{ pos.clicks | round }}</td>
                        <td>{{ pos.difference | percent:'1.0-0' }}</td>
                    </tr>
                </table>
            </md-tab>
            <md-tab label="CTR Stats">
                <!--<table>-->
                    <!--<thead>-->
                    <!--<tr>-->
                        <!--<th>Position</th>-->
                        <!--<th>Data queries</th>-->
                    <!--</tr>-->
                    <!--</thead>-->
                    <!--<tbody>-->
                    <!--<tr *ngFor="let pos of positions_stats">-->
                        <!--<td>{{ pos.position }}</td>-->
                        <!--<td><span *ngFor="let id of pos.row_indexes">{{ id }} | </span></td>-->
                    <!--</tr>-->
                    <!--</tbody>-->
                <!--</table>-->
                <table>
                    <thead>
                    <tr>
                        <th>Position</th>
                        <th>Count of Instances</th>
                        <th>Sum of Clicks</th>
                        <th>Sum of Impressions</th>
                        <th>Average of Expected CTR</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let pos of positions_stats">
                        <td>{{ pos.position }}</td>
                        <td>{{ pos.instances }}</td>
                        <td>{{ pos.clicks_sum }}</td>
                        <td>{{ pos.impressions_sum }}</td>
                        <td>{{ pos.expected_ctr_avg | percent:'1.0-0' }}</td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td>Grand Total</td>
                        <td>{{ grand_total.instances_sum }}</td>
                        <td>{{ grand_total.clicks_sum_sum }}</td>
                        <td>{{ grand_total.impressions_sum_sum }}</td>
                        <td>{{ grand_total.expected_ctr_avg | percent:'1.0-2' }}</td>
                    </tr>
                    </tfoot>
                </table><br><br>
                <table>
                    <tr>
                        <th>Position</th>
                        <th>Average CTR real</th>
                        <th>Average CTR calculated</th>
                    </tr>
                    <tr *ngFor="let pos of positions_stats_resulted">
                        <td>{{ pos.position }}</td>
                        <td *ngIf="pos.expected_ctr_avg != 0">{{ pos.expected_ctr_avg | percent:'1.0-0' }}</td>
                        <td *ngIf="pos.expected_ctr_avg == 0"></td>
                        <td>{{ pos.ctr_calculated | percent:'1.0-0'}}</td>
                    </tr>
                </table>
            </md-tab>
        </md-tab-group>
        <div id="chartNonBranded"></div>
        <div id="chartBranded"></div>
    </div>
</div>
