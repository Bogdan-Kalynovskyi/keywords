<div *ngIf="report" class="report-content" [ngClass]="{ 'read-only': !isOwner }">
    <div>
        <md-input-container *ngIf="isOwner">
            <span mdTooltip="You should press 'Save button' to save your changes">
                <input mdInput placeholder="Report name" [(ngModel)]="report.name" />
            </span>
        </md-input-container>
        <md-input-container *ngIf="!isOwner">
            <input mdInput placeholder="Report name" [(ngModel)]="report.name" disabled />
        </md-input-container>
        <md-input-container *ngIf="isOwner">
            <span mdTooltip="You should press 'Save button' to save your changes">
                <input mdInput placeholder="Branded keywords" [(ngModel)]="report.keywords" (change)="onDataChange()" />
            </span>
        </md-input-container>
        <md-input-container *ngIf="!isOwner">
            <input mdInput placeholder="Branded keywords" [(ngModel)]="report.keywords" (change)="onDataChange()" />
        </md-input-container>
        <span mdTooltip="You should press 'Save button' to save your changes" *ngIf="isOwner">
            <input type="file" accept=".csv" (change)="onFileChange($event)">
        </span>
        <input type="file" accept=".csv" (change)="onFileChange($event)" *ngIf="!isOwner">
        <button *ngIf="isOwner" md-raised-button color="primary" (click)="updateData()">Save changes</button>
        <div *ngIf="!isOwner" class="warning">Your changes could not be saved</div>
    </div>
    <div class="scrolling-content">
        <md-tab-group>
            <md-tab label="CSV_import">
                <div class="data-table-container">
                    <table id="data" class="data-table">
                        <tr>
                            <th (click)="setSort($event)">Queries</th>
                            <th (click)="setSort($event)">Clicks</th>
                            <th (click)="setSort($event)">Impressions</th>
                            <th (click)="setSort($event)">CTR</th>
                            <th (click)="setSort($event)">Position</th>
                        </tr>
                        <tr *ngFor="let dataTable of data">
                            <td>{{ dataTable.queries }}</td>
                            <td>{{ dataTable.clicks }}</td>
                            <td>{{ dataTable.impressions }}</td>
                            <td>{{ dataTable.ctr | percent:'1.0-2' }}</td>
                            <td>{{ dataTable.position }}</td>
                        </tr>
                    </table>
                </div>
            </md-tab>
            <md-tab label="CSV 5+">
                <div class="data-table-container">
                    <table id="filteredData" class="data-table">
                        <tr>
                            <th (click)="setSort($event)">Queries</th>
                            <th (click)="setSort($event)">Clicks</th>
                            <th (click)="setSort($event)">Impressions</th>
                            <th (click)="setSort($event)">CTR</th>
                            <th (click)="setSort($event)">Position</th>
                        </tr>
                        <tr *ngFor="let dataTable of filteredData">
                            <td>{{ dataTable.queries }}</td>
                            <td>{{ dataTable.clicks }}</td>
                            <td>{{ dataTable.impressions }}</td>
                            <td>{{ dataTable.ctr | percent:'1.0-2' }}</td>
                            <td>{{ dataTable.position }}</td>
                        </tr>
                    </table>
                </div>
            </md-tab>
            <md-tab label="All Queries">
                <div class="data-table-container">
                    <table id="allQueriesData" class="data-table">
                        <tr>
                            <th (click)="setSort($event)">Queries</th>
                            <th (click)="setSort($event)">Clicks</th>
                            <th (click)="setSort($event)">Impressions</th>
                            <th (click)="setSort($event)">Position</th>
                            <th (click)="setSort($event)">CTR</th>
                            <th (click)="setSort($event)">Instances</th>
                            <th (click)="setSort($event)">Expected CTR</th>
                            <th (click)="setSort($event)">CTR&#916;</th>
                            <th (click)="setSort($event)">Expected Clicks</th>
                            <th (click)="setSort($event)">Traffic Loss</th>
                            <th (click)="setSort($event)">Traffic Gain</th>
                            <th (click)="setSort($event, 'nr', 0)">#1</th>
                            <th (click)="setSort($event, 'nr', 1)">#2</th>
                            <th (click)="setSort($event, 'nr', 2)">#3</th>
                            <th (click)="setSort($event, 'nr', 3)">#4</th>
                            <th (click)="setSort($event, 'nr', 4)">#5</th>
                            <th (click)="setSort($event, 'nr', 5)">#6</th>
                            <th (click)="setSort($event, 'nr', 6)">#7</th>
                            <th (click)="setSort($event, 'nr', 7)">#8</th>
                            <th (click)="setSort($event, 'nr', 8)">#9</th>
                            <th (click)="setSort($event, 'nr', 9)">#10</th>
                            <th (click)="setSort($event, 'nr', 10)">1+</th>
                        </tr>
                        <tr *ngFor="let dataTable of allQueriesData">
                            <td>{{ dataTable.queries }}</td>
                            <td>{{ dataTable.clicks }}</td>
                            <td>{{ dataTable.impressions }}</td>
                            <td>{{ dataTable.position }}</td>
                            <td>{{ dataTable.calculatedCtr | percent:'1.0-0' }}</td>
                            <td>{{ dataTable.instance }}</td>
                            <td>{{ dataTable.expected_ctr | percent:'1.0-2' }}</td>
                            <td>{{ dataTable.ctr_delta | percent:'1.0-2' }}</td>
                            <td>{{ dataTable.expected_clicks | round}}</td>
                            <td>{{ dataTable.traffic_loss | round }}</td>
                            <td>{{ dataTable.traffic_gain | round }}</td>
                            <td *ngFor="let pos of dataTable.nr">{{ pos | round }}</td>
                        </tr>
                    </table>
                </div>
            </md-tab>
            <md-tab label="Non-Branded">
                <div class="data-table-container">
                    <table id="nonBrandedData" class="data-table">
                        <tr>
                            <th (click)="setSort($event)">Queries</th>
                            <th (click)="setSort($event)">Clicks</th>
                            <th (click)="setSort($event)">Impressions</th>
                            <th (click)="setSort($event)">Position</th>
                            <th (click)="setSort($event)">CTR</th>
                            <th (click)="setSort($event)">Instances</th>
                            <th (click)="setSort($event)">Expected CTR</th>
                            <th (click)="setSort($event)">CTR&#916;</th>
                            <th (click)="setSort($event)">Expected Clicks</th>
                            <th (click)="setSort($event)">Traffic Loss</th>
                            <th (click)="setSort($event)">Traffic Gain</th>
                            <th (click)="setSort($event, 'nr', 0)">#1</th>
                            <th (click)="setSort($event, 'nr', 1)">#2</th>
                            <th (click)="setSort($event, 'nr', 2)">#3</th>
                            <th (click)="setSort($event, 'nr', 3)">#4</th>
                            <th (click)="setSort($event, 'nr', 4)">#5</th>
                            <th (click)="setSort($event, 'nr', 5)">#6</th>
                            <th (click)="setSort($event, 'nr', 6)">#7</th>
                            <th (click)="setSort($event, 'nr', 7)">#8</th>
                            <th (click)="setSort($event, 'nr', 8)">#9</th>
                            <th (click)="setSort($event, 'nr', 9)">#10</th>
                            <th (click)="setSort($event, 'nr', 10)">1+</th>
                        </tr>
                        <tr *ngFor="let dataTable of nonBrandedData">
                            <td>{{ dataTable.queries }}</td>
                            <td>{{ dataTable.clicks }}</td>
                            <td>{{ dataTable.impressions }}</td>
                            <td>{{ dataTable.position }}</td>
                            <td>{{ dataTable.ctr | percent:'1.0-2' }}</td>
                            <td>{{ dataTable.instance }}</td>
                            <td>{{ dataTable.expected_ctr | percent:'1.0-2' }}</td>
                            <td>{{ dataTable.ctr_delta | percent:'1.0-2' }}</td>
                            <td>{{ dataTable.expected_clicks | round }}</td>
                            <td>{{ dataTable.traffic_loss | round}}</td>
                            <td>{{ dataTable.traffic_gain | round }}</td>
                            <td *ngFor="let pos of dataTable.nr">{{ pos | round }}</td>
                        </tr>
                    </table>
                </div>
            </md-tab>
            <md-tab label="Report">
                <table>
                    <tr>
                        <th colspan="2">All Queries</th>
                    </tr>
                    <tr>
                        <th>Traffic Loss</th>
                        <th>Traffic Gain</th>
                    </tr>
                    <tr>
                        <td>{{ (all_queries_traffic_loss * 100 | round ) /100  }}</td>
                        <td>{{ (all_queries_traffic_gain * 100 | round ) /100}}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Non-Branded Queries</th>
                    </tr>
                    <tr>
                        <th>Traffic Loss</th>
                        <th>Traffic Gain</th>
                    </tr>
                    <tr>
                        <td>{{ (non_branded_traffic_loss * 100 | round ) /100 }}</td>
                        <td>{{ (non_branded_traffic_gain * 100 | round ) /100 }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Branded Under-Performance</th>
                    </tr>
                    <tr>
                        <td>Traffic Loss</td>
                        <td>{{ ((all_queries_traffic_loss - non_branded_traffic_loss)  * 100 | round ) /100 }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <td>Potential traffic (non branded)</td>
                        <td>{{ non_branded_traffic_loss >= 0 ? (non_branded_traffic_loss  * 100 | round ) /100 : (non_branded_traffic_loss*(-1) * 100 | round ) /100 }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Top Ten Winners</th>
                        <th>Traffic gain</th>
                    </tr>
                    <tr *ngFor="let item of top_traffic_gain; let i = index">
                        <td>{{ i + 1 }}</td>
                        <td>{{ item.queries }}</td>
                        <td>{{ (item.traffic_gain * 100 | round)/100 }}</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>Top 10 gain traffic</td>
                        <td>{{ (sum_top_traffic_gain * 100 | round)/100 }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Top Ten Losers</th>
                        <th>Traffic loss</th>
                    </tr>
                    <tr *ngFor="let item of top_traffic_loss; let i = index">
                        <td>{{ i + 1 }}</td>
                        <td>{{ item.queries }}</td>
                        <td>{{ (item.traffic_loss * 100 | round) / 100 }}</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>Top 10 gain traffic</td>
                        <td>{{ (sum_top_traffic_loss * 100 | round) / 100 }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Top 10 CTR Statistics</th>
                    </tr>
                    <tr *ngFor="let pos of top_ctr_statistics">
                        <td>Position {{ pos.position }}</td>
                        <td>{{ pos.ctr_calculated | percent:'1.0-0' }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="2">Current keywords positions</th>
                    </tr>
                    <tr *ngFor="let pos of positions; let i = index">
                        <td>Position {{ i + 1 }}</td>
                        <td>{{ pos }}</td>
                    </tr>
                </table><br><br>
                <table>
                    <tr>
                        <th colspan="3">Non branded keywords (if scenario)</th>
                    </tr>
                    <tr>
                        <th>Position</th>
                        <th>Clicks</th>
                        <th>Difference</th>
                    </tr>
                    <tr *ngFor="let pos of non_branded_keywords">
                        <td>{{ pos.position }}</td>
                        <td>{{ pos.clicks | round }}</td>
                        <td>{{ pos.difference | percent:'1.0-0' }}</td>
                    </tr>
                </table>
            </md-tab>
            <md-tab label="CTR Stats">
                <!--<table>-->
                    <!--<thead>-->
                    <!--<tr>-->
                        <!--<th>Position</th>-->
                        <!--<th>Data queries</th>-->
                    <!--</tr>-->
                    <!--</thead>-->
                    <!--<tbody>-->
                    <!--<tr *ngFor="let pos of positions_stats">-->
                        <!--<td>{{ pos.position }}</td>-->
                        <!--<td><span *ngFor="let id of pos.row_indexes">{{ id }} | </span></td>-->
                    <!--</tr>-->
                    <!--</tbody>-->
                <!--</table>-->
                <table>
                    <thead>
                    <tr>
                        <th>Position</th>
                        <th>Count of Instances</th>
                        <th>Sum of Clicks</th>
                        <th>Sum of Impressions</th>
                        <th>Average of Expected CTR</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let pos of positions_stats">
                        <td>{{ pos.position }}</td>
                        <td>{{ pos.instances }}</td>
                        <td>{{ pos.clicks_sum }}</td>
                        <td>{{ pos.impressions_sum }}</td>
                        <td>{{ pos.expected_ctr_avg | percent:'1.0-0' }}</td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td>Grand Total</td>
                        <td>{{ grand_total.instances_sum }}</td>
                        <td>{{ grand_total.clicks_sum_sum }}</td>
                        <td>{{ grand_total.impressions_sum_sum }}</td>
                        <td>{{ grand_total.expected_ctr_avg | percent:'1.0-2' }}</td>
                    </tr>
                    </tfoot>
                </table><br><br>
                <table>
                    <tr>
                        <th>Position</th>
                        <th>Average CTR real</th>
                        <th>Average CTR calculated</th>
                    </tr>
                    <tr *ngFor="let pos of positions_stats_resulted">
                        <td>{{ pos.position }}</td>
                        <td *ngIf="pos.expected_ctr_avg != 0">{{ pos.expected_ctr_avg | percent:'1.0-0' }}</td>
                        <td *ngIf="pos.expected_ctr_avg == 0"></td>
                        <td>{{ pos.ctr_calculated | percent:'1.0-0'}}</td>
                    </tr>
                </table>
            </md-tab>
        </md-tab-group>
    </div>
</div>
